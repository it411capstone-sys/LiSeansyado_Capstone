rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Profile Pictures: Publicly readable, but only the user can write to their own folder.
    match /profile_pictures/{userId}/{allPaths=**} {
      allow read;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Verification Documents: Only the user can write, only authenticated users can read.
    match /verification_documents/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Registration Photos: Publicly readable, but only authenticated users can write.
    match /registrations/{registrationId}/{allPaths=**} {
      allow read;
      allow write: if request.auth != null;
    }

    // Inspection Photos: Admins (or authenticated users) can upload, all can read.
    match /inspections/{inspectionId}/{allPaths=**} {
        allow read;
        allow write: if request.auth != null;
    }

    // Receipts: Users can only write to a path corresponding to their transaction.
    match /receipts/{transactionId}/{allPaths=**} {
        allow read: if request.auth != null; // Or make it public if admins need access without auth
        allow write: if request.auth != null;
    }
  }
}
